---
name: GPT 计划文档生成
overview: 在 plan/gpt 目录下生成 3 份互相引用的 Markdown：路线与目标、架构设计、分阶段开发计划与任务，内容以 brainstorm-session 为主并融合现有 technical-roadmap 与 development-plan，去重补齐并补充验收标准、里程碑与风险。
todos:
  - id: collect-sources
    content: 阅读并抽取 `docs/brainstorm-session.md`、`docs/technical-roadmap.md`、`docs/development-plan.md` 的关键信息（模块、Phase、指标、风险、关键接口）。
    status: completed
  - id: write-roadmap-goals
    content: 生成 `plan/gpt/roadmap-and-goals.md`：路线/目标/里程碑/指标/体积预算/风险与缓解。
    status: completed
    dependencies:
      - collect-sources
  - id: write-design-spec
    content: 生成 `plan/gpt/design-spec.md`：清晰详细的架构设计文档，包含必要的 mermaid 流程图与关键接口约定。
    status: completed
    dependencies:
      - collect-sources
  - id: write-phases-tasks
    content: 生成 `plan/gpt/phases-and-tasks.md`：Phase 0-8 的详细计划与任务拆解，补齐依赖关系与验收标准/测试要求。
    status: completed
    dependencies:
      - collect-sources
  - id: consistency-pass
    content: 统一术语与引用，确保三份文档互相链接正确、无重复冲突、验收标准可执行。
    status: completed
    dependencies:
      - write-roadmap-goals
      - write-design-spec
      - write-phases-tasks
---

# 在 `plan/gpt` 生成研发路线、设计文档与阶段计划

## 目标与产出

- 在 [`plan/gpt/`](plan/gpt/) 生成 **3 个 md 文件**，分别覆盖：
- **研发路线与目标**（愿景/范围/里程碑/指标/体积预算/风险）
- **清晰详细的设计文档**（模块划分、核心数据结构、关键算法、渲染/交互/命令/插件的时序与数据流）
- **各阶段开发计划与任务**（Phase 0-8：任务拆解、依赖关系、交付物、验收标准、测试与性能基准）
- 内容来源：以 [`docs/brainstorm-session.md`](docs/brainstorm-session.md) 为主，融合对齐 [`docs/technical-roadmap.md`](docs/technical-roadmap.md) 与 [`docs/development-plan.md`](docs/development-plan.md)，做到：**术语一致、重复合并、缺口补齐、指标可验收**。

## 文件清单（拟定命名）

- [`plan/gpt/roadmap-and-goals.md`](plan/gpt/roadmap-and-goals.md)
- 项目定位与边界（Excel 对标范围、非目标）
- 核心指标（性能/体积/内存/兼容性）与测量方式
- Phase 0-8 总览（含里程碑 M0-M5）
- 体积预算（core < 60KB gz, 总目标 < 100KB gz）与模块分摊
- 技术风险与缓解（Canvas、公式、内存、跨端、触摸/IME 等）
- [`plan/gpt/design-spec.md`](plan/gpt/design-spec.md)
- 总体架构与包结构（`@holy-sheet/core` + 插件包）
- 核心数据模型（Workbook/Sheet/CellData/StylePool/RichText/MergeIndex）
- 布局系统（IndexMapper/AccumulatorCache/HiddenRanges/LayoutManager）
- 渲染系统（Viewport/Layer/DirtyRect/Path2D 批量、merge clearRect、copy 平移）
- 事件与交互（EventEmitter/EventManager/InteractionState/Selection/Keyboard/Touch/AutoScroller/CellEditor/ContextMenu）
- 命令系统（CommandDispatcher/Undo/Transaction/命令合并窗口）
- 插件系统（Plugin/Manifest/Manager/Context/钩子链路与返回值约定）
- Worker 路线（Phase 1 主线程渲染 + Worker 计算；Phase 2 OffscreenCanvas）
- 关键流程图（用 mermaid：渲染流程、命令执行链、插件钩子调用链）
- [`plan/gpt/phases-and-tasks.md`](plan/gpt/phases-and-tasks.md)
- 每个 Phase 的：目标、范围、依赖、任务列表、交付物、验收标准（DoD）、测试/基准
- 明确“先做什么才能做什么”（例如：Phase 2 依赖 Phase 1 的数据模型；交互依赖视口/坐标映射）
- 对齐现有任务清单，并补充缺失的：接口草案、错误处理策略、边界用例、性能测试脚本要求

## 内容编写原则（保证可执行）

- 统一命名：Workbook/Sheet/CellData、SelectionManager、CommandDispatcher、PluginManager 等与现有文档一致。
- 每个阶段至少包含：
- **验收标准**（可被测试/基准验证的条件）
- **性能门槛**（如滚动 60fps、首屏 < 50ms、百万单元格加载 < 1s 的测量口径）
- **测试要求**（Vitest 单测覆盖点 + Playwright E2E 覆盖点）
- 对 brainstorm 中“已确认”的方案（渲染分层、脏矩形、布局缓存、命令合并、IME 策略、插件钩子等）作为主线写入设计，并在必要处补上接口与边界。

## 实施步骤

- 阅读并抽取三份源文档的：模块清单、Phase 拆分、关键设计与指标。
- 合并去重：以 Phase 0-8 为骨架，把 brainstorm 的“设计决定”落到可实现的接口与流程。
- 在 `plan/gpt` 写入 3 份 md，互相交叉引用 `docs/` 下原始文档。
- 最后通读检查：术语一致、无冲突、任务可落地、验收标准可测。